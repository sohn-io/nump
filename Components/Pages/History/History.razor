@page "/history"
@inject NumpContext _context
@inject NavigationManager _Nav
<RadzenRow>
    <RadzenColumn Size="4">
        <RadzenText TextStyle="TextStyle.DisplayH4" Text="Task Runs" />
    </RadzenColumn>
</RadzenRow>

<RadzenDataGrid Data="@taskLogs">
    <Columns>
        <RadzenDataGridColumn Property="RunTime" Title="Run Time" />
        <RadzenDataGridColumn Property="TaskDisplayName" Title="Task Name" />
        <RadzenDataGridColumn Property="CurrentStatus" Title="Status" />
        <RadzenDataGridColumn Property="Result" Title="Result" />
        <RadzenDataGridColumn>
            <Template Context="taskLog">
                <RadzenButton Text="Modification History" Variant="Variant.Text" Size="ButtonSize.Small" Click="@(() => GoToModification(taskLog.Guid))" />
                <RadzenButton Text="Creation History" Variant="Variant.Text" Size="ButtonSize.Small" Click="@(() => GoToCreation(taskLog.Guid))" />
            </Template>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>
@code {

    private List<TaskLog> taskLogs = new List<TaskLog>();
    
    private async Task GoToModification(Guid TaskRunId)
    {
        _Nav.NavigateTo($"/history/user/{TaskRunId}");
    }
    private async Task GoToCreation(Guid TaskRunId)
    {
        _Nav.NavigateTo($"/history/user/creation/{TaskRunId}");
    }
    protected override async Task OnInitializedAsync()
    {
        taskLogs = await _context.TaskLogs.OrderByDescending(x => x.RunTime).ToListAsync();
    }
}